try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8d799841-c921-4402-8f79-1a6732104652",e._sentryDebugIdIdentifier="sentry-dbid-8d799841-c921-4402-8f79-1a6732104652")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65055],{0x112f760bb:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(0x22102fd88),a=s(0xfc89b4a4);let n=(0,a.forwardRef)((e,t)=>{let{className:s,children:n,disabled:o,noDefaultScroll:i}=e,l=(0,a.useRef)(0),u=(0,a.useRef)(!0),d=(0,a.useRef)(null),c=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(d.current&&u.current&&!(d.current.scrollHeight-d.current.clientHeight<d.current.scrollTop)&&d.current&&"function"==typeof d.current.scrollTo){var t,s,r;null==(r=d.current)||r.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)-(null==(s=d.current)?void 0:s.clientHeight)+5,behavior:e})}},[]),f=(0,a.useCallback)(e=>{if(d.current&&d.current&&"function"==typeof d.current.scrollTo){var t,s,r;d.current.style.overflow="hidden",null==(r=d.current)||r.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)*e-(null==(s=d.current)?void 0:s.clientHeight)/2,behavior:"auto"})}},[]),h=(0,a.useCallback)(()=>{d.current&&(d.current.style.overflow="")},[]);return(0,a.useImperativeHandle)(t,()=>({reset(){l.current=0,u.current=!0,i||c()},scrollToBottomIfPinned:c,scrollToPercentage:f,enableScrolling:h,getScrollContainer:()=>d.current}),[c,f,h,i]),(0,a.useLayoutEffect)(()=>{o||!n||i||c()},[n,o,c,i]),(0,r.jsx)("div",{className:s,onScroll:e=>{if(o)return;let t=e.currentTarget.scrollTop,s=function(e,t){if(!e)return!1;{let s=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(s)}}(d.current,t),r=t>l.current;s&&r?u.current=!0:s||r||(u.current=!1),l.current=t},ref:d,children:n})});n.displayName="AutoScroll"},0x19c41663f:(e,t,s)=>{s.d(t,{_:()=>h});var r=s(0x1137a9c1a),a=s(0x156c4e43b);let n=a.Ik({name:a.Yj().optional(),url:a.Yj().optional(),type:a.Yj().optional()}),o=new Set(["accept","accept-language","content-type","content-length"]),i=new Set(["set-cookie","x-api-key","x-auth-token","authorization"]),l=["api.anthropic.com"],u=!1,d=[];async function c(e,t){return u=!0,new Promise(s=>{t({requestedServers:e,onClose:()=>{s();let e=d.shift();e?setTimeout(()=>{c(e.validRequestedServers,e.setArtifactMcpModal).then(()=>{e.resolve()})},100):u=!1}})})}let f={"api.anthropic.com":async(e,t)=>await fetch("/api/organizations/".concat(e,"/proxy/v1/messages"),t)};async function h(e,t,s,r,h,p){let g,{url:y,method:x,headers:b,body:w,channelId:v}=e,C=new URL(y),R={};for(let[e,t]of Object.entries(b))o.has(e.toLowerCase())&&(R[e]=t);r&&(R["anthropic-artifact-id"]=r.uuid,R["anthropic-artifact-entity-type"]=r.type);let M=w;if(p&&h&&w&&l.some(e=>e===C.hostname)){let e=new TextDecoder().decode(w),t=a.Ik({mcp_servers:a.YO(n).optional()}).passthrough().parse(JSON.parse(e));if(t.mcp_servers&&Array.isArray(t.mcp_servers)){let e=t.mcp_servers.filter(e=>e.url);e.length>0&&(u?await new Promise(t=>{d.push({validRequestedServers:e,setArtifactMcpModal:p,resolve:t})}):await c(e,p));let s=new TextEncoder().encode(JSON.stringify(t));M=s.buffer instanceof ArrayBuffer?s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):new ArrayBuffer(0)}}let S=new AbortController;if(C.hostname in f)g=await f[C.hostname](s||"",{method:x,headers:R,body:M||void 0,signal:S.signal,redirect:"manual"});else throw Error("Unable to proxy requests for ".concat(C.hostname,"."));let k={};return g.headers.forEach((e,t)=>{i.has(t.toLowerCase())||(k[t]=e)}),m(g,v,t),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse",status:g.status,statusText:g.statusText,headers:k}}async function m(e,t,s){var a;let n=null==(a=e.body)?void 0:a.getReader();if(!n)return void await s(r.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});let o=0;try{for(;;){let{done:e,value:a}=await n.read();if(e){await s(r.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});break}if(a){let e;if((o+=a.byteLength)>0xa00000)throw Error("Response body exceeds maximum size of ".concat(0xa00000," bytes"));let n=0===a.byteOffset&&a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);e=n instanceof ArrayBuffer?n:new Uint8Array(n).slice().buffer,await s(r.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:e,done:!1},[e])}}}catch(e){await s(r.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{n.releaseLock()}}},0x1ad992c78:(e,t,s)=>{s.d(t,{E:()=>i});var r=s(0x9845e38c),a=s(0xfc89b4a4),n=s(0x1137a9c1a),o=s(0x1fb8fadd1);function i(e){let{iframeRef:t,allowedOrigin:s,onRateLimited:i=null,initialPermissions:l,onPermissionRequested:u,onCapabilityAction:d}=e,[c,f]=(0,a.useState)(null),h=(0,a.useRef)(l),[m,p]=(0,a.useState)(0);(0,a.useEffect)(()=>{if(!t.current&&m<20){let e=setTimeout(()=>{p(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void r.v.warn(r.u.ARTIFACTS,"Max retries reached while waiting for iframe");let e=new o.x({iframe:t.current,allowedOrigin:s,onRateLimited:i,onPermissionRequested:async e=>{if(n.tH.includes(e)||"accepted"===h.current[e])return"accepted";let t=await u(e);return h.current={...h.current,[e]:t},t},onCapabilityAction:d});return f(e),()=>{e.cleanup()}},[t,s,h,i,u,d,m]);let g=(0,a.useCallback)(async(e,t)=>{if(c)return c.sendRequest(e,t);throw Error("Communicator not initialized")},[c]),y=(0,a.useCallback)(()=>{null==c||c.restartListening()},[c]),x=(0,a.useCallback)((e,t)=>{h.current={...h.current,[e]:t}},[]);return{sendRequest:null===c?void 0:g,restartListening:y,permissions:h.current,updatePermission:x}}},0x1ce8093a4:(e,t,s)=>{s.d(t,{A:()=>k});var r=s(0x22102fd88),a=s(0x1cf5ab98a),n=s(0x155df12ed),o=s(0x1ab0d1ca1),i=s(0x38e6572);let l=e=>{let{isOpen:t=!1,filename:s,onClose:l,onConfirm:u}=e,d=(0,o.A)();return(0,r.jsxs)(n.aF,{title:d.formatMessage({defaultMessage:"Download file",id:"k9qHCCLPA5"}),isOpen:t,onClose:l,children:[(0,r.jsxs)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:[(0,r.jsx)(i.A,{defaultMessage:"Artifacts are created by other users and aren’t verified by Anthropic. Only download files you trust.",id:"MDebIUeu03"}),(0,r.jsx)("pre",{className:"font-mono text-wrap text-sm p-2 my-2 rounded border border-border-400 bg-bg-000",children:s})]}),(0,r.jsxs)(n.vW,{children:[(0,r.jsx)(a.$,{variant:"secondary",onClick:l,children:(0,r.jsx)(i.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,r.jsx)(a.$,{onClick:u,children:(0,r.jsx)(i.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})]})]})};var u=s(0x24573a476),d=s(0x14de19ae8),c=s(0x246846ae8),f=s(0x252daebb2),h=s(0xac309a83),m=s(0xfc89b4a4);let p=e=>{let{isOpen:t=!1,onClose:s,onConfirm:l}=e,u=(0,o.A)(),[p,g]=(0,m.useState)(!1),y=(0,h.fS)("claude_create_pebble_stone"),{activeOrganization:x}=(0,d.YL)();return(0,m.useEffect)(()=>{!t||y&&(null==x?void 0:x.uuid)||s()},[t,y,null==x?void 0:x.uuid,s]),(0,r.jsxs)(n.aF,{title:u.formatMessage({defaultMessage:"Access shared data",id:"BgSBBhOmOQ"}),isOpen:t,onClose:s,children:[(0,r.jsx)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:(0,r.jsx)(f.YX,{id:"velvet_cupcake_spark"})}),(0,r.jsx)("div",{className:"mt-4 mb-2",children:(0,r.jsx)(c.Sc,{label:(0,r.jsx)("span",{className:"text-sm text-text-100",children:(0,r.jsx)(i.A,{defaultMessage:"Remember my choice for this session",id:"ihRWxb7Azt"})}),checked:p,onChange:g})}),(0,r.jsxs)(n.vW,{children:[(0,r.jsx)(a.$,{variant:"secondary",onClick:()=>s(p),children:(0,r.jsx)(i.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),(0,r.jsx)(a.$,{onClick:()=>l(p),children:(0,r.jsx)(i.A,{defaultMessage:"Allow",id:"y/bmsG8rnv"})})]})]})};var g=s(0xa5acf583),y=s(0x24fcf6beb),x=s(0x253a5c787),b=s(0x1a1f6dda6),w=s(0x160045b25),v=s(0x1dc411c0f),C=s(0x1137a9c1a),R=s(0x19c41663f),M=s(0x6520adcb),S=s(0x1ad992c78);let k=(0,m.forwardRef)((e,t)=>{let{content:s,className:n,type:c,onSandboxConfirmation:f,onDOMContentLoaded:k,capabilities:j,onReportError:E,onSetContent:A,onRefresh:P,externalLinkBehavior:q,onOpenExternalLinkRequest:T,onTrackInteraction:L,showLoginModal:I,lazy:_=!0,zoom:N=1,artifactContext:O,ArtifactMcpModal:F,isChatStreaming:Z}=e,H=(0,o.A)(),{userContentRendererUrl:D}=(0,g._r)(),U=(0,h.fS)("claude_create_marble"),B=(0,h.fS)("claudeai_anorak_senator_shoreline"),[G,z]=(0,m.useState)(!1),Y=(0,m.useRef)(null),W="".concat(D).concat((null==O?void 0:O.uuid)&&"published_artifact"===O.type?"/artifact/"+O.uuid:""),J=window.location.hostname,K=new URLSearchParams;K.set("domain",J),E&&K.set("errorReportingMode","parent"),B&&K.set("formattedSpreadsheets","true");let Q=K.toString()?"".concat(W,"?").concat(K.toString()):W;(0,m.useEffect)(()=>{let e=Y.current;if(e&&navigator.userAgent.toLowerCase().includes("firefox")){e.setAttribute("data-no-service-worker","true");let t=setTimeout(()=>{e.sandbox&&e.src&&(e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("referrerpolicy","no-referrer"))},0);return()=>clearTimeout(t)}},[]);let[$,V]=(0,m.useState)(null),[X,ee]=(0,m.useState)(null),[et,es]=(0,m.useState)(null),[er,ea]=(0,m.useState)(null),[en,eo]=(0,m.useState)(null),[ei,el]=(0,m.useState)([]),[eu,ed]=(0,m.useState)([]),{activeOrganization:ec}=(0,d.YL)(),ef=(0,m.useCallback)((e,t,s)=>Z?new Promise((r,a)=>{let n={method:e,data:t,executeOperation:s,resolve:r,reject:a,artifactUuid:null==O?void 0:O.uuid};ed(e=>{var t;return(null==O?void 0:O.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[n]:[...e,n]})}):s(),[Z,null==O?void 0:O.uuid,ed]),eh=(0,h.fS)("apps_use_turmeric"),em=(0,h.fS)("artifact_tailwind_styles"),[ep,eg]=(0,m.useState)(0),ey=(0,m.useCallback)(async(e,t)=>{var s,r,a,n;if(e.method===C.uZ.ReadyForContent)return z(!0),null==f||f(),Promise.resolve();if(e.method===C.uZ.GetFile)return j&&j.getFile?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await j.getFile(e.payload.key)}:Promise.reject();if(e.method===C.uZ.SendConversationMessage)return j&&j.sendMessage?(await j.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===C.uZ.ClaudeCompletion)return j&&j.claudeComplete?(eg(e=>e+1),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await j.claudeComplete(e.payload.prompt)}):Promise.reject();if(e.method===C.uZ.StorageGet){if(!(null==j||null==(s=j.storage)?void 0:s.get))return Promise.reject();let t=j.storage.get,r=async()=>{let s=await t(e.payload.key,e.payload.shared);return s?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetResponse",key:s.key,value:s.value,shared:s.shared}:null};return ef("get",e.payload,r)}else if(e.method===C.uZ.StorageSet){if(!(null==j||null==(r=j.storage)?void 0:r.set))return Promise.reject();let t=j.storage.set,s=async()=>{let s=await t(e.payload.key,e.payload.value,e.payload.shared);return s?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetResponse",key:s.key,value:s.value,shared:s.shared}:null},a=async()=>!0===e.payload.shared?"allow"===er?s():"deny"===er?Promise.reject():new Promise((e,t)=>{es({onConfirm:async()=>{try{let t=await s();e(t)}catch(e){t(e)}es(null)}})}):s();return ef("set",e.payload,a)}else if(e.method===C.uZ.StorageDelete){if(!(null==j||null==(a=j.storage)?void 0:a.delete))return Promise.reject();let t=j.storage.delete,s=async()=>{let s=await t(e.payload.key,e.payload.shared);return s?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteResponse",key:s.key,deleted:s.deleted,shared:s.shared}:null},r=async()=>!0===e.payload.shared?"allow"===er?s():"deny"===er?Promise.reject():new Promise((e,t)=>{es({onConfirm:async()=>{try{let t=await s();e(t)}catch(e){t(e)}es(null)}})}):s();return ef("delete",e.payload,r)}else if(e.method===C.uZ.StorageList){if(!(null==j||null==(n=j.storage)?void 0:n.list))return Promise.reject();let t=j.storage.list,s=async()=>{let s=await t(e.payload.prefix,e.payload.shared);return s?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListResponse",keys:s.keys,prefix:s.prefix,shared:s.shared}:null};return ef("list",e.payload,s)}else if(e.method===C.uZ.BroadcastContentSize);else if(e.method===C.uZ.DOMContentLoaded)return null==k||k(),Promise.resolve();else if(e.method===C.uZ.OpenExternal){if("ask"===q)return V(e.payload.href),Promise.resolve();if("bubble"===q&&T)return T({href:e.payload.href}),Promise.resolve()}else if(e.method===C.uZ.DownloadFile)return ee(e.payload),Promise.resolve();else if(e.method===C.uZ.ReportError)return null==E||E(e.payload.error),Promise.resolve();else if(e.method===C.uZ.TrackInteraction)return null==L||L(e.payload),Promise.resolve();else if(e.method===C.uZ.ProxyFetch)return(null==ec?void 0:ec.uuid)?Z?new Promise((s,r)=>{let a={data:e.payload,sendRequest:t,resolve:s,reject:r,artifactUuid:null==O?void 0:O.uuid};el(e=>{var t;return(null==O?void 0:O.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[a]:[...e,a]})}):(0,R._)(e.payload,t,null==ec?void 0:ec.uuid,O,U,eo):(null==I||I(),Promise.reject());return Promise.reject()},[f,k,j,z,E,eg,q,T,L,I,null==ec?void 0:ec.uuid,O,U,Z,er,ef]),ex=(0,m.useCallback)(async e=>e===C.uZ.ClaudeCompletion&&ep>=100?"denied":Promise.resolve("accepted"),[ep]),{sendRequest:eb,updatePermission:ew}=(0,S.E)({iframeRef:Y,allowedOrigin:D,onCapabilityAction:ey,onPermissionRequested:ex,initialPermissions:{}});(0,m.useEffect)(()=>{ep>=100&&(ew(C.uZ.ClaudeCompletion,"denied"),(0,x.wd)("Claude completion request limit hit."))},[ep,ew]),(0,m.useEffect)(()=>{(async()=>{!Z&&ei.length>0&&(null==ec?void 0:ec.uuid)&&(null==O?void 0:O.uuid)&&(await Promise.all(ei.map(async e=>{let{data:t,sendRequest:s,resolve:r,reject:a}=e;try{let e=await (0,R._)(t,s,ec.uuid,O,U,eo);r(e)}catch(e){a(e)}})),el([]))})()},[Z,ei,null==ec?void 0:ec.uuid,O,U]),(0,m.useEffect)(()=>{(async()=>{!Z&&eu.length>0&&(null==O?void 0:O.uuid)&&(await Promise.all(eu.map(async e=>{let{executeOperation:t,resolve:s,reject:r}=e;try{let e=await t();s(e)}catch(e){r(e)}})),ed([]))})()},[Z,eu,O]);let ev=(0,m.useCallback)(()=>{(0,x.wd)("Claude completion modal confirmed"),eg(0),ew(C.uZ.ClaudeCompletion,"accepted")},[ew]),eC=(0,m.useCallback)(async()=>{let e=await (null==eb?void 0:eb(C.uZ.GetScreenshot,M.qs));if(null==e?void 0:e.screenshot){if(e.screenshot.length>0xa00000)throw Error(H.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(H.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[H,eb]),eR=(0,m.useCallback)(async()=>{let e=await (null==eb?void 0:eb(C.uZ.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[eb]),eM=(0,m.useCallback)(async()=>{let e=await (null==eb?void 0:eb(C.uZ.GetDOMSnapshot,M.qs));return(null==e?void 0:e.domSnapshot)||void 0},[eb]);return(0,m.useEffect)(()=>{G&&s&&c&&(null==A||A(),Object.values(y.vU).includes(c)?null==eb||eb(C.uZ.SetContent,{content:s,type:c,tailwindStylesEnabled:em,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}):null==eb||eb(C.uZ.SetContent,{content:s,type:c,tailwindStylesEnabled:em,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[s,eb,c,G,A,em]),(0,m.useImperativeHandle)(t,()=>({refresh:()=>{null==P||P(),z(!1);let e=Y.current;if(e){let t=e.parentNode;t?(t.removeChild(e),e.removeAttribute("src"),e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("data-no-service-worker","true"),e.setAttribute("referrerpolicy","no-referrer"),e.src=Q,t.appendChild(e)):e.src=Q}},getScreenshot:eC,copyHtmlContent:eR,getDOMSnapshot:eM})),(0,r.jsxs)("div",{className:(0,b.A)("relative",n),children:[(0,r.jsx)("iframe",{ref:Y,className:"h-full w-full",style:{zoom:N},sandbox:"allow-scripts allow-same-origin",title:H.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:_?"lazy":void 0,src:Q,allow:"fullscreen; clipboard-write",referrerPolicy:"no-referrer"}),(0,r.jsx)(w.N,{children:!G&&(0,r.jsx)(v.P.div,{className:"bg-bg-000 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),$?(0,r.jsx)(u.v,{isOpen:!!$,url:$,onClose:()=>V(null),onConfirm:()=>{$&&window.open($,"_blank"),V(null)}}):null,X?(0,r.jsx)(l,{isOpen:!!X,filename:X.filename,onClose:()=>ee(null),onConfirm:()=>{if(X){let e=new Blob([X.data],{type:X.mimeType}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=X.filename,s.click(),URL.revokeObjectURL(t)}ee(null)}}):null,et?(0,r.jsx)(p,{isOpen:!!et,onClose:e=>{e&&ea("deny"),es(null)},onConfirm:async e=>{et&&(e&&ea("allow"),await et.onConfirm())}}):null,en&&F&&O?(0,r.jsx)(F,{isOpen:!!en,requestedServers:en.requestedServers,onClose:()=>{en.onClose(),eo(null)},artifactContext:O}):null,eh&&ep>=100&&(0,r.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,r.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,r.jsx)("p",{className:"text-fg-100 mb-4",children:(0,r.jsx)(i.A,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,r.jsx)(a.$,{onClick:ev,variant:"primary",children:(0,r.jsx)(i.A,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});k.displayName="RichSandbox"},0x1fb8fadd1:(e,t,s)=>{s.d(t,{x:()=>i});var r=s(0x9845e38c),a=s(0x1137a9c1a),n=s(0x6520adcb);let o=new Map;class i{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let s=n._s.safeParse(e.data);if(!s.success)return void r.v.warn(r.u.ARTIFACTS,"Received message does not conform to basic message shape, ignoring");let a=s.data;if("response"===a.channel)return void this.handleResponse(a);this.messageQueue.push(a),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||o.get(e.requestId);if(void 0!==t){t(e),o.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=a.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let s=t.data,o=a.x8.safeParse(e);if(!o.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let i=o.data;if(this.requestLog.has(i.requestId)){this.sendErrorResponse(i.requestId,400,"Request ID already processed");continue}this.requestLog.set(i.requestId,{message:i,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(s).then(e=>"denied"!==e||(this.sendErrorResponse(i.requestId,403,"Permission denied"),!1)).catch(e=>(r.v.error(r.u.ARTIFACTS,"Error checking permission for method ".concat(s,":"),e),this.sendErrorResponse(i.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(i,this.boundSendRequest).then(e=>{var t;let s=n.Ko.parse({channel:"response",status:200,requestId:i.requestId,payload:null!=e?e:n.qs}),r=this.requestLog.get(i.requestId);r&&this.requestLog.set(i.requestId,{...r,response:s,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(s,this.allowedOrigin)}).catch(e=>{r.v.error(r.u.ARTIFACTS,"Error processing action for method ".concat(s,":"),e),this.sendErrorResponse(i.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,s){var r;let a=n.t6.parse({channel:"response",status:t,requestId:e,payload:(0,n.SV)(s)}),o=this.requestLog.get(e);o&&this.requestLog.set(e,{...o,response:a,responseTimestamp:new Date().getTime()}),null==(r=this.iframe.contentWindow)||r.postMessage(a,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,s){return new Promise((r,i)=>{var l,u;let d=Date.now().toString(),c={channel:"request",method:e,requestId:d,payload:t},f=e=>{let t=n.Ko.safeParse(e);if(!t.success)return void i(Error("Invalid response format"));let s=t.data;if(s.status>=400){let e=n.t6.safeParse(s);e.success?i(Error(e.data.payload.error)):i(Error("Error response (".concat(s.status,")")));return}let o=a.v9.safeParse(s);o.success?r(o.data.payload):i(Error("Invalid response payload for the method"))};this.inFlightRequests.set(d,f),o.set(d,f),s&&s.length>0?null==(l=this.iframe.contentWindow)||l.postMessage(c,this.allowedOrigin,s):null==(u=this.iframe.contentWindow)||u.postMessage(c,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,s]=e;return{...s,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:s=null,onPermissionRequested:r,onCapabilityAction:a}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=s,this.onPermissionRequested=r,this.onCapabilityAction=a,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}},0x253ff6d66:(e,t,s)=>{s.d(t,{i:()=>u});var r=s(0x22102fd88),a=s(0xfc89b4a4),n=s(0x1ab0d1ca1),o=s(0x1cf5ab98a),i=s(0x1ab362a20);let l=e=>{let{handleClose:t,title:s,description:a,inset:n,action:l}=e;return(0,r.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,r.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:s}),(0,r.jsx)("p",{className:"mb-2 text-sm",children:a}),!!n&&(0,r.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:n}),l&&(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(o.$,{variant:"primary",className:"mt-4 text-sm",onClick:l.onClick,disabled:l.disabled,loading:l.loading,children:l.label})}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(o.$,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,r.jsx)(i.X,{})})})]})},u=e=>{var t,s,o;let{error:i,handleClose:u,sendMessage:d,isStreaming:c}=e,[f,h]=(0,a.useState)(!1),m=(0,n.A)(),p=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message};case"ArtifactStorageError":return{title:t?t.formatMessage({defaultMessage:"Error accessing shared data",id:"hjqZygykww"}):"Error accessing shared data",description:e.message}}}(i.error,m),g="> ".concat(p.description,"\n  ").concat(null!=(o=null==(t=p.inset)?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))?o:"","\n  \n\n  Can you fix this error in `").concat(i.artifactId,"`?"),y=d?{label:m.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{h(!0),null==d||d({prompt:g,attachments:[],files:[],syncSources:[]})},disabled:c,loading:f}:void 0;return(0,r.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,r.jsx)(l,{title:p.title,description:p.description,handleClose:u,inset:(null==(s=p.inset)?void 0:s.length)?p.inset?(0,r.jsx)("ul",{children:p.inset.map((e,t)=>(0,r.jsx)("li",{children:e},t))}):null:void 0,action:y})})}}}]);